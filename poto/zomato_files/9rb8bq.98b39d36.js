(this.$WP=this.$WP||[]).push(["9rb8bq",(e,t)=>{"use strict";var a,r,i,n,o,l,s,d,c,u,p,v,T,S,m,C,E,b,f,I,g,h,k,y,_,A,M,O,j,R,P,L,w,N,x,D,V,F,q,U,z=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!(null==(i=t.paginatedTrips)||!i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},G=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!(null==(t=e.actionPermissions)||!t.canAddItem)}}},W=e=>{var t,a,r,i,n,o=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},l={offset:0,limit:10,userId:b()||"",reference:u(e),loadSavedTrips:!0},[s,d]=j({query:P,variables:l,combineData:z,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>o(e,t),moveTripItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type)}}),c=(null==(t=s.data)||null==(a=t.paginatedTrips)?void 0:a.trips)||[],p=c.slice().filter(Boolean).map(G),v=!(null==(r=s.data)||null==(i=r.paginatedTrips)||!i.hasMore),T=(null==(n=s.data)?void 0:n.savedTrips)||[],S=new Set(T.map((e=>null==e?void 0:e.id)).filter(Boolean)),m=v?()=>d({offset:(null==c?void 0:c.length)||0,loadSavedTrips:!1}):()=>Promise.resolve();return{fetching:s.fetching,error:!!s.error,data:{tripList:p,saveSet:S,canMakePublicTrip:!0},hasMore:v,loadMore:m}},B="tvfpI Fn f u j",Q="RyNfJ",$={DEFAULT:e=>L(A,"bundleSave"!==e?{id:"stat_modal_save_to_trip_v2"}:{id:"save_all_items_modal_header"}),CREATE:()=>L(A,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>L(A,{id:"select_trip_header"}),SELECT_CREATE:()=>L(A,{id:"stat_modal_create_a_trip_v2"})},X=({saveObject:e,overlayState:t,validateTripName:a,lastSavedItem:o,trackingContext:s,trackingSource:d,...c})=>{var u,[v,T]=r(!0),{fetching:S,error:m,data:C,hasMore:E,loadMore:b}=w(e);S?u=L(_,{size:"large"}):m&&(u=L(O,{refetch:b})),i((()=>{S||T(!1)}),[]);var[f]=l({source:d||"trips",trackingContext:s,pageAsContext:!0,withSaveSession:!0}),I=()=>{c.onClose(),T(!0)},g=$[t](e.type),A=L(k,{icon:y,displayType:"LEFT_ALIGN_GRAY",children:g});return L(M,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal",children:L(h,{header:A,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:I,children:u&&v?L("div",{className:B,children:u}):L(n,{fallback:L("div",{className:B,children:L(_,{size:"large"})}),children:(()=>{var r=o?p(o):void 0,i=()=>L("div",{className:Q,children:L(N,{gate:()=>Promise.resolve(),object:e,onMount:()=>{S||m||f({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{c.statCallback("ADD","NEW",e,!0,!0),I()},onError:c.onError,canMakePublicTrip:C.canMakePublicTrip,validateTripName:a,trackingContext:s,trackingSource:d})});switch(t){case"DEFAULT":return 0===C.tripList.length?i():L(D,{tripList:C.tripList,savedSet:C.saveSet,tripListBottom:u,onPaginate:b,hasMore:E,saveObject:e,onMount:()=>{c.preventInteractionInMountedComponents||f({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onCreateTripClicked&&c.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),I()},onSavedToTrip:(e,t,a)=>{c.statCallback("ADD","EXISTING",e,t,a),I()},onError:c.onError,trackingContext:s,trackingSource:d});case"CREATE":return i();case"SELECT":return r?L(D,{tripList:C.tripList,savedSet:C.saveSet,tripListBottom:u,onPaginate:b,hasMore:E,saveObject:r,onMount:()=>{f({elementClick:{element:"stat"}})},onCreateTrip:()=>{c.onSelectCreateTripClicked&&c.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{c.statCallback("MOVE","EXISTING",e,t,a),I()},onRemovedFromTrip:(e,t,a)=>{c.statCallback("REMOVE","EXISTING",e,t,a),I()},onError:c.onError,trackingContext:s,trackingSource:d}):"";case"SELECT_CREATE":return o?L("div",{className:Q,children:L(x,{gate:()=>Promise.resolve(),item:o,onMovedToCreatedTrip:e=>{c.statCallback("MOVE","NEW",e,!0,!0),I()},canMakePublicTrip:C.canMakePublicTrip})}):i();default:return""}})()})})})},H=e=>{},Y=(e,t)=>{var a;switch(t.type){case"setOverlayState":return{...e,overlayState:null!=(a=t.state)?a:e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw new Error}},J=({allowPopStatModal:e,logInteraction:t,puid:r,object:i,active:n,preventInteractionPropagation:o,trackingContext:l,trackingSource:s,resaveTrip:c,saveObject:u,saveStatus:p,updateLastTripId:v,onClose:S,initialOverlayState:m,...C})=>{var E,g=b(),{launchViewTripToast:h,launchRemoveFromTripToast:k,launchErrorTripToast:y}=T(),{getTripErrorMessage:_}=f(),A=I("SAVE_TO_TRIP_INTENT"),M=I("SAVE_TO_TRIP"),O=I({type:"CREATE_TRIP",payload:{user_id:g||""}}),j=a.useContext(d),[R,P]=a.useReducer(Y,{overlayState:m||"DEFAULT",preventInteractionInMountedComponents:!1}),w=a.useRef(!0);a.useEffect((()=>()=>{w.current=!1}),[]);var{onComplete:N}=C,x=a.useCallback((e=>{N&&N(e),j.resetSession()}),[N,j]),D=a.useCallback(((e,a)=>{e&&!a?(h(e,"SAVED",(()=>{t({elementClick:{element:"saved_viewTrip"}})})),x(!0)):a&&(y(a),x(!1)),w.current&&P({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})}),[h,x,y,t]),F=a.useCallback((e=>{k(e,u,D)}),[k,D,u]),q=a.useCallback((e=>{y(e)}),[y]),[U,z]=a.useState(!1),G=a.useCallback((()=>{z(!0),j.resetSession()}),[j]),W=a.useCallback(((e,a)=>{"CREATED"===a&&(M(),O()),w.current&&P({type:"afterSave"}),h(e,a,(()=>{t({elementClick:{element:"saved_viewTrip"}})})),v(e.id),x(!0)}),[M,h,x,v,O,t]);return U?null:L("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!o&&g&&t({elementClick:{element:"item_save",tripId:null==c?void 0:c.id}}),n||A()},children:L(V,{saveObject:u,overlayState:R.overlayState,lastSavedItem:null==(E=p.result)?void 0:E.tripItem,trackingContext:l,trackingSource:s,onCreateTripClicked:()=>{w.current&&P({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{w.current&&P({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:G,onError:q,preventInteractionInMountedComponents:R.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(F(a),x(i)):"NEW"===t?W(a,"CREATED"):r&&W(a,"SAVED")},validateTripName:e=>{if("bundleSave"===u.type&&e.trim().toLowerCase()===i.title.trim().toLowerCase())return _("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}})})},K=e=>L(s,{children:L(g,{children:L(J,{...e})})}),Z=["Profile","HomeFeed","Trips","Home"],ee=e=>{var t=a.useMemo((()=>e.saveObject||p(e.object,!0)),[e.saveObject,e.object]),{resaveTrip:r,onComplete:i,allowPopStatModal:n,flowOrigin:o}=e,{isNativeWebview:s,tripId:u,...v}=e,{launchAutoSavedToTripToast:b,launchErrorTripToast:f}=T(),I=S(),{page:g}=I,h=a.useMemo((()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0})),[e.trackingContext,e.trackingSource,t]),[k,y]=l(h),_=a.useContext(d),[A,M,O]=m(u,t,e.active),j=null==t?void 0:t.id,R=null==t?void 0:t.type,P=a.useCallback((e=>{f(e)}),[f]),w=a.useCallback((()=>{k({elementClick:{element:"ITEM_SAVE_LOGIN",context:g&&c(g)||void 0,puid:y,saveType:R,detailId:j?`${j}`:"",tripId:null==r?void 0:r.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,g,y,r,j,R,_.sessionOrder,_.sessionUuid]),N=a.useCallback((()=>{k({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:g&&c(g)||void 0,puid:y,saveType:R,detailId:j?`${j}`:"",tripId:null==r?void 0:r.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,g,y,r,j,R,_.sessionOrder,_.sessionUuid]),x=a.useMemo((()=>({pid:g&&Z.includes(I.page)?40439:39766,flow:s?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:o,onLogin:w,onSuccess:N,isFullWidthMobile:!0})),[w,N,g,I.page,s,o]),D=C(x),V=a.useRef(!1),{open:q}=E((()=>t?L(F,{...v,logInteraction:k,puid:y,saveObject:t,saveStatus:A,updateLastTripId:O}):null)),{open:U}=E((()=>t?L(F,{...v,initialOverlayState:"SELECT",logInteraction:k,puid:y,saveObject:t,saveStatus:A,updateLastTripId:O}):null)),z=!!n&&"popStat"in I.params&&I.params.popStat;return a.useEffect((()=>{z&&!V.current&&(V.current=!0,k({elementClick:{element:"autoPopStat"}}),D().then(q))}),[k,D,q,z]),a.useCallback((()=>{D().then((()=>M())).then((([e,t])=>{null!==e||null!==t?t?P({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(b(e,(()=>{U(),k({elementClick:{element:"quickSave_change"}})})),k({modalSuccess:{element:"quickSave",tripId:null==r?void 0:r.id,context:g&&c(g)||void 0,saveType:R,detailId:j?`${j}`:""}}),i&&i(!0)):q()}))}),[q,U,b,k,D,i,P,M,g,r,j,R])},te=({children:e,...t})=>{var r=a.useMemo((()=>t.saveObject||p(t.object,!0)),[t.saveObject,t.object]),i=q(t);return r?L(s,{children:e(i)}):null},ae=({queryObject:e,children:t,...r})=>{var i,n,o,l,s,d,c,u,p,v,[T,S]=a.useState(null!=(i=r.object)&&null!=(n=i.object)&&n.socialStatistics?!(null==(o=r.object)||null==(l=o.object)||null==(s=l.socialStatistics)||!s.isSaved):!(null==(d=r.object)||null==(c=d.socialStatistics)||!c.isSaved)),m=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"};v=b()?null!=(null==(u=r.object)||null==(p=u.socialStatistics)?void 0:p.isSaved)?"afterInvalidation":"immediately":"never";var[{fetching:C,data:E,error:f}]=R({query:e.query,variables:e.variables,executeWhen:v},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>m(e,t),tripsRemoveItem:({variables:{reference:e}})=>m(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>m(e.id,null==e?void 0:e.type)});return a.useEffect((()=>{if(!C&&!f){var t=E&&E.savesObjects&&E.savesObjects[0];if(t){var{id:a,socialStatistics:r={}}=t,i=(a===e.id||String(a)===e.id)&&!!r.isSaved;i!==T&&S(i)}}}),[C,E,f]),L(U,{active:T,...r,children:e=>t(e,T,C)})},re=e=>{var t=e.saveObject||p(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var a=v(t);return a?L(ae,{...e,queryObject:a}):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{w=W,N=o((()=>t("5kzfzt").then((e=>({default:e.CreateTripWithAddItemModal}))))),x=o((()=>t("5kzfzt").then((e=>({default:e.CreateTripWithMoveItemModal}))))),D=o((()=>t("an5ymg").then((e=>({default:e.SaveToTripContent}))))),V=X,J.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},F=K,q=ee,U=te,re.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:re,TripFlowSelector:U,setSTATDisabledForTesting:H})},[e=>(a=e,r=e.useState,i=e.useEffect,n=e.Suspense,o=e.lazy),e=>(l=e.useTripInteraction,s=e.SaveSessionProvider,d=e.SaveSessionTrackingContext,c=e.getInteractionsContext),e=>(u=e.toReference,p=e.toSavesObject,v=e.objectStatisticQuery),e=>T=e.default,e=>S=e.useRoute,e=>m=e.useAutosave,e=>C=e.useSocialLoginGate,e=>E=e.useVDOMPortal,e=>b=e.useUserId,e=>f=e.useLocalizeTripError,e=>I=e.usePixelCallback,e=>g=e.ToastProvider,e=>h=e.default,e=>k=e.TitleBar,e=>y=e.default,e=>_=e.LoadingSpinner,e=>A=e.default,e=>M=e.TripsImpression,e=>O=e.default,e=>(j=e.usePaginatedQuery,R=e.useInvalidatableQuery),e=>P=e.TripDetailStatQuery,e=>L=e.jsx]]},["1o4yt4","1k7dpq","1iyqcw","12wscm","fgwvq1","1uw9rn","10506z","14euae","52far5","mc5s4b","1emwhd","tr3542","17u7gi","cnyhjq","1l75rc","1l9qeu","17thqz","665v5s","qhcore","1fbuhs","ag9b0s","121h32"]]);
