(this.$WP=this.$WP||[]).push(["1lmi3n",(e,i)=>{"use strict";var n,t,a,l,r,c,o,u,s,d,m,g,f,v,b,p,_,h,C,y,D,I,w,N,k,T,P,S,R,A,B,O,x,q,z,L,M,E,W,j,V,$,Y,F,G,H,K,U,J={__key:0xfea813c1c414,id:"fea813c1c4141f2f6c2406107ad958dd",loc:{},definitions:[]};function Q({title:e,image:i,rating:n,reviewCount:t,primaryInfo:a}){var l="MOBILE"===E()?40:70;return z("div",{className:"AmoZi u",children:[L(Y,{source:i,width:l,height:l}),z("div",{className:"ZSPYS",children:[L(u,{variant:"title-04",children:e}),L("div",{className:"WrQxz",children:L(F,{size:"small",rating:n,numReviews:t})}),L(u,{variant:"supporting-01",children:a})]})]})}function Z(){return L(f,{id:"gemini.t4b.dining.club.activate.offer.modal.title"})}function X({locationInformation:e,offer:i,activateOfferButton:n,next:t,restrictions:a,hasDiscountCode:l}){var r,c,o,s,m=_(null==e?void 0:e.locationId),g=null==e?void 0:e.name;return z(M,{children:[L("div",{className:"kVOJI",children:L(Q,{title:g||"",image:(null==e||null==(r=e.thumbnail)?void 0:r.photoSizes)||[],rating:(null==e||null==(c=e.reviewSummary)?void 0:c.rating)||0,reviewCount:(null==e||null==(o=e.reviewSummary)?void 0:o.count)||0,primaryInfo:(null==e||null==(s=e.streetAddress)?void 0:s.street1)||""})}),z("div",{className:"wSodi",children:[z("div",{children:[L(u,{variant:"title-04",elementType:"p",marginBottom:"spacing-03",children:L(f,{id:"gemini.dc.rr.commerce.ad.tag.headline",args:{restaurantName:g||""}})}),z("ul",{children:[L("li",{children:L(u,{variant:"title-04",elementType:"span",children:L(f,{id:"gemini.t4b.dining.club.offer.amount.off",args:{offerAmount:(null==i?void 0:i.offerAmount)||0}})})}),m&&L("li",{children:L(u,{variant:"title-04",elementType:"span",children:m})}),a&&a.split("\n").map((e=>L("li",{children:L(u,{variant:"title-04",elementType:"span",children:e})}))),l&&L("li",{children:L(u,{variant:"title-04",elementType:"span",children:L(f,{id:"gemini.b2c.dining.club.restaurant_review.commerce.details_list.coupon_code"})})})]})]}),L("div",{className:"WvLNV",children:n}),z("div",{className:"wHvdG",children:[L(u,{variant:"supporting-01",elementType:"p",marginTop:"spacing-03",marginBottom:"spacing-03",children:L(f,{id:"gemini.t4b.dining.club.activate.offer.info"})}),z(u,{variant:"supporting-03",elementType:"p",children:[L(f,{id:"gemini.t4b.dining.club.activate.offer.info2"}),L(d,{onClick:t,marginLeft:"spacing-01",children:L($,{})})]})]})]})]})}function ee(){return L(f,{id:"gemini.t4b.dining.club.help.restaurants.title"})}function ie(){return L(u,{variant:"body-01",children:L(f,{id:"gemini.t4b.dining.club.help.restaurants.body"})})}function ne({locationInformation:e,offer:i,onClose:n,restrictions:t,hasDiscountCode:a}){var d=I(),g=w(),{localize:b}=v(),p=E(),[_,h]=l(!0),[C,y]=l(!1),D="MOBILE"===p,N=j(),{fetching:k,createDiningClubTicket:P,error:S}=function(){var[{fetching:e,error:i},n]=T(J),{isValidMember:t}=A(),{capabilities:a}=B();return{fetching:e,createDiningClubTicket:async e=>t&&null!=a&&a.includes("CREATE_TICKETS")?n({request:e}):Promise.reject(new Error("Not Allowed")),error:i}}();r((()=>{g({itemName:"DiningClubActivation"})}),[g]);var R=c((()=>{y(!1);var{offerId:t}=i||{},{locationId:a}=e||{};null!=t&&null!=a&&P({locationId:a,offerId:t}).then((i=>{var l;if(i.error)y(!0);else{d({itemName:"DiningClubActivation",actionType:"click",actionSubType:"activateOfferConfirmation",taAnalytics:{ticketId:t},mixpanel:{eventName:"b2c_dc_activation_success_click",restaurantId:null==e||null==(l=e.locationId)?void 0:l.toString(),ticketId:t}});var r=new URLSearchParams;r.set("screen","mycard"),r.set("offer",t),N(`/DiningClubHome?${r.toString()}#${a}`)&&(null==n||n())}})).catch((()=>y(!0)))}),[d,e,i,N,n,P]),O=o((()=>L(s,{variant:"commerce",fullWidth:D,size:D?"large":"medium",loading:k,"aria-label":b.string("gemini.b2c.dining.club.activate.offer.modal.cta"),onClick:R,children:L(f,{id:"gemini.b2c.dining.club.activate.offer.modal.cta"})})),[D,k,b,R]),x=c((()=>{h(!1),d({itemName:"DiningClubActivation",actionType:"click",actionSubType:"tooltip"})}),[d,h]),q=o((()=>[{title:L(Z,{}),content:L(X,{offer:i,activateOfferButton:O,locationInformation:e,next:x,restrictions:t,hasDiscountCode:a})},{title:L(ee,{}),content:L(ie,{})}]),[i,O,e,x,t,a]),M=_?null:L(m,{variant:"clear",icon:V,size:"small","aria-label":b.string("common_go_back_1cfb"),onClick:()=>{h(!0)}}),{title:$,content:Y}=_?q[0]:q[1];return L("div",{className:"YwkOX",children:z(W,{title:$,onClose:n,primaryButton:!D&&_?O:void 0,buttonsAlignment:"left",widthOption:"fixed-40",backButton:M||null,closeButtonPosition:_?"right":"none",children:[Y,(S||C)&&z(u,{color:"dangerText",variant:"body-01",marginTop:"spacing-03",children:[L(f,{id:"b2b_page_not_available_header"})," ",L(f,{id:"plus_please_try_again_later"})]})]})})}var te="NBPHy z Pk PY Px PK Gi",ae="f k u MJ",le={__key:0xd9fab45f5bde,id:"d9fab45f5bde8395f2510fe4734b5bef",loc:{},definitions:[]},re={__key:0x9de2de40bad8,id:"9de2de40bad8a0dd3c41ac798b4a4fd3",loc:{},definitions:[]},ce=()=>{var e,i,n,t,a,l,r,c,o,u,s,d,m,g,f,v,b,p,_,h,C,y,D,I,w,N,k,T,A,B,q,z=O(),L=x(),M=S(),E=R(),W=null,j=null;"Restaurant_Review"===M.page&&(W=M.params.detailId,j=M.params.geoId);var[{data:V,fetching:$}]=P({query:le,variables:{locationId:null!=(e=W)?e:0,geoId:null!=(i=j)?i:0},pause:null==W||!z}),[{data:Y,fetching:F}]=P({query:re,pause:null==W||!z||!E}),[G]=(null==V||null==(n=V.DiningClub_listDiningClubRestaurants)||null==(t=n.restaurants)||null==(a=t[0])?void 0:a.offers)||[],H=void 0!==((null==Y||null==(l=Y.DiningClub_userSubscriptionWithFields)||null==(r=l.user)?void 0:r.activeTickets)||[]).find((e=>{var i,n;return(null==e||null==(i=e.offer)||null==(n=i.location)?void 0:n.locationId)===W})),K=null==V||null==(c=V.locations)?void 0:c[0],U="LIVE"===(null==V||null==(o=V.DiningClub_listDiningClubRestaurants)||null==(u=o.restaurants)||null==(s=u[0])||null==(d=s.offers)||null==(m=d[0])?void 0:m.status),J=!(null==V||null==(g=V.DiningClub_listDiningClubRestaurants)||null==(f=g.restaurants)||null==(v=f[0])||null==(b=v.offers)||null==(p=b[0])||!p.discountCode),Q=null!=(_=null==V||null==(h=V.DiningClub_listDiningClubRestaurants)||null==(C=h.restaurants)||null==(y=C[0])||null==(D=y.offers)||null==(I=D[0])?void 0:I.restrictions)?_:"";return{fetching:$||F,offerDetails:G,locationDetails:K,isTicketActive:H,isRestaurantPartOfDiningClub:U,isDiningClubMemberLoggedIn:L,restaurantsCount:null==V||null==(w=V.DiningClub_listDiningClubGeos)||null==(N=w.geos)||null==(k=N[0])?void 0:k.count,restrictions:Q,geoId:null==V||null==(T=V.DiningClub_listDiningClubGeos)||null==(A=T.geos)||null==(B=A[0])||null==(q=B.primaryLocation)?void 0:q.locationId,locationId:W,hasDiscountCode:J}},oe="clone___nvt_dining_club_acq_commerce_unit_test_1661871995",ue=()=>{var e=q({experimentKeys:[oe]});return"test"===(null==e?void 0:e[oe])},se="DiningClubCommerceSection",de=()=>{var{fetching:e,offerDetails:i,locationDetails:n,isTicketActive:t,isDiningClubMemberLoggedIn:a,restaurantsCount:l,restrictions:d,geoId:m,locationId:T,isRestaurantPartOfDiningClub:P,hasDiscountCode:S}=G(),{localize:R}=v(),A=w(),B=I(),{data:O}=y(),x=H(),q=_(T),{data:M}=C(),E="PAYMENT_ERROR"===M;r((()=>{e||A({itemName:"DiningClubRestaurantDetail",taAnalytics:{diningClubPageState:a?"member":"acquisition"},mixpanel:a?{eventName:"b2c_dc_member_restaurant_DP_view"}:void 0})}),[e,a,A]);var W,j=o((()=>[R.string("gemini.b2c.dining.club.restaurant_review.commerce.details_list.item_discount",{offerAmount:(null==i?void 0:i.offerAmount)||20}),...q?[q]:[],...S?[R.string("gemini.b2c.dining.club.restaurant_review.commerce.details_list.coupon_code")]:[]]),[R,null==i?void 0:i.offerAmount,S,q]),{open:V}=h((({close:e})=>L(ne,{locationInformation:n,restrictions:d,offer:i,onClose:e,hasDiscountCode:S}))),$=c((()=>{a?t?B({actionType:"click",actionSubType:"viewActivatedOffer",itemName:se,mixpanel:{eventName:"b2c_dc_member_restaurant_DP_view_activated_card_click",restaurantId:T}}):(V(),B({actionType:"click",actionSubType:"activateOffer",itemName:se,mixpanel:{eventName:"b2c_dc_member_restaurant_DP_activate_offer_click",restaurantId:T}})):B(P?{actionType:"click",itemName:"DiningClubCommerceButtonAd"}:{actionType:"click",itemName:"DiningClubCommerceButtonNonParticipatingAd"})}),[a,P,t,B,T,V]),Y=null,F=!1;if(a)t?(Y=R.string("gemini.b2c.dining.club.restaurant_review.commerce.cta.view_card"),W=`/DiningClubHome?screen=mycard#${T}`):Y=R.string("gemini.b2c.dining.club.restaurant_review.commerce.cta.activate_offer");else{Y=R.string("gemini.dining.club.try.cta");var K=new URLSearchParams;K.set("locationId",String(m)),W=`/DiningClub?${K.toString()}`,F=!0}var U=o((()=>{if(!l)return"";if(l<=5)return R.string("gemini.b2c.dining.club.restaurant_review.commerce.description_title",{restaurantsCount:l});var e=N(l);return R.string("gemini.b2c.dining.club.restaurant_review.commerce.description_title.v2",{restaurantsCount:e})}),[l,R]),J=o((()=>L(f,P?a?{id:"gemini.dc.rr.commerce.ad.tag.headline",args:{restaurantName:(null==n?void 0:n.name)||""}}:{id:"gemini.b2c.dining.club.restaurant_review.commerce.details_list.heading_2",args:{restaurantName:(null==n?void 0:n.name)||""}}:{id:"gemini.b2c.dining.club.restaurant_review.commerce.details_list.cross_sell_heading",args:{geoName:m===+k.NEW_YORK?R.string("gemini.b2c.dining.club.shelf_ad.locations.nyc"):(null==n?void 0:n.geoName)||""}})),[m,a,P,R,null==n?void 0:n.geoName,null==n?void 0:n.name]);return!e&&!a&&x&&P?z("div",{className:te,children:[z("div",{className:ae,children:[L(p,{size:36}),L(g,{variant:"secondary",children:L(f,{id:"gemini.common.dining.club.label.new"})})]}),L(u,{elementType:"p",variant:"expressive-body-01",marginTop:"spacing-04",marginBottom:"spacing-05",children:L(b,{id:"gemini.b2c.dining.club.restaurant_review.commerce.details_list.cross_sell_heading_ab_test",args:{percents:"20%",restaurantName:(null==n?void 0:n.name)||""}})}),L(s,{fullWidth:!0,variant:"commerce",onClick:$,target:F?"_blank":void 0,href:W,children:L(f,{id:"gemini.b2c.dining.club.restaurant_review.commerce.cta.start_saving"})})]}):!e&&(a&&P||!a)?z("div",{className:te,children:[z("div",{className:ae,children:[L(p,{size:36}),L(g,{variant:"secondary",children:L(f,{id:"gemini.common.dining.club.label.new"})})]}),L(u,{elementType:"p",variant:"title-05",marginBottom:"spacing-02",children:J}),P&&z("ul",{className:"RmQPn MJ",children:[j.map((e=>L("li",{children:L(u,{elementType:"span",variant:"body-01",children:e})},e))),d?d.split("\n").map((e=>L("li",{children:L(u,{elementType:"span",variant:"body-01",children:e})}))):null]}),!a&&null!=l&&L(u,{elementType:"p",variant:"supporting-01",marginBottom:"spacing-03",children:L(b,{id:"gemini.b2c.dining.club.restaurant_review.commerce.description_acq_3",args:{title:U,durationInDays:30,restaurantsCount:l,oldPrice:O.originalPriceString,newPrice:O.priceString}})}),L(s,{disabled:E,fullWidth:!0,variant:"commerce",onClick:$,target:F?"_blank":void 0,href:W,children:Y}),E&&L(D,{marginTop:"spacing-03"})]}):null},me=()=>{var{hasDiningClubOffer:e,hasRestaurantSpecialOffer:i}=a();return e?L(K,{}):L(t,{hasRestaurantSpecialOffer:i})};return[()=>{G=ce,H=ue,K=de,U=n(((e,i)=>(t.stage(e,i),()=>({}))))(me),e("default",U)},[e=>n=e.bind,e=>(t=e.default,a=e.useCommercePlacements),e=>(l=e.useState,r=e.useEffect,c=e.useCallback,o=e.useMemo),e=>u=e.default,e=>(s=e.default,d=e.BorderlessButton,m=e.CircularButton),e=>g=e.default,e=>(f=e.default,v=e.useLocalize,b=e.UnsafeLocalize),e=>p=e.default,e=>_=e.default,e=>h=e.useVDOMPortal,e=>C=e.usePaymentStatus,e=>y=e.useProductDetails,e=>D=e.PaymentFailBanner,e=>(I=e.useInteractionLogger,w=e.useImpressionLogger),e=>(N=e.roundCounter,k=e.LOCATIONS),e=>(T=e.useMutation,P=e.useQuery),e=>S=e.useRoute,e=>R=e.useUserId,e=>(A=e.useIsDiningClubMemberLoggedInState,B=e.useMemberCapabilities,O=e.useIsDiningClubFeatureEnabled,x=e.useIsDiningClubMemberLoggedIn),e=>q=e.default,e=>(z=e.jsxs,L=e.jsx,M=e.Fragment),e=>E=e.useViewportCategory,e=>W=e.Modal,e=>j=e.useNavigate,e=>V=e.default,e=>$=e.default,e=>Y=e.default,e=>F=e.BubbleRatingWithReviewCount]]},["16z5q2","1wvntj","1o4yt4","1essqv","jppfwt","oz3g7e","17thqz","1m5udk","1ofqwp","14euae","1d7ku1","1mhqyg","1ox4jt","16676n","pe9247","1mqwhq","fgwvq1","52far5","1cwn4k","gugp1d","121h32","1ys6v1","1i3sz5","10ad67","17nq86","zq967r","34bu7w","1bkeq2"]]);
